var G=Object.defineProperty;var K=(e,t,r)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var $=(e,t,r)=>(K(e,typeof t!="symbol"?t+"":t,r),r),z=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var v=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)};var E=(e,t,r)=>(z(e,t,"access private method"),r);var Q=(e,t)=>{switch(t){case"any":return e;case"text":return e&&e.toString();case"json":return JSON.stringify(e)}throw new Error("unknown request data type")},X=(e,t)=>{switch(t){case"arrayBuffer":return e.arrayBuffer();case"blob":return e.blob();case"formData":return e.formData();case"json":return e.json();case"text":return e.text()}throw new Error("unknown response type")},_={baseHref:"",timeout:0,method:"POST",headers:{"Content-Type":"application/json"},requestType:"json",responseType:"json"};function Y({url:e,data:t,body:r,input:s=c=>c,output:i=c=>c,baseHref:n=_.baseHref,method:o=_.method,headers:u=_.headers,timeout:l=_.timeout,requestType:h=_.requestType,responseType:a=_.responseType}={}){if(!e)throw new Error("url required");e=e.indexOf("http")<0&&n?n+e:e,t=s(t);let c={method:o,headers:{...u}};!(o==="GET"||o==="HEAD")&&(c.body=r||Q(t,h));let d=new AbortController;c.signal=d.signal;let b=new Promise(async(m,w)=>{let g;l&&(g=setTimeout(()=>{d.abort()},l)),c.signal.onabort=()=>{w(new Error("aborted"))};try{let p=await fetch(e,c);if(g&&clearTimeout(g),!p.ok)throw await p.body.cancel(),{[p.status]:p.statusText};let T=await X(p,a);m(await i(T))}catch(p){w(p)}});return b.abort=()=>d.abort(),b}var Z=e=>e!==null&&e instanceof Object&&e.constructor===Object,ge=e=>async t=>{let r=await Y({...e,data:{...e.data||{},...t}});if(Z(r)){let{data:s,errors:i}=r;if(Boolean(s)^Boolean(i)){if(i)throw i;return s}}return r},V=/(\/\/.*$)|(\/\*[\s\S]*?\*\/)|(\s*=[^,\)]*(('(?:\\'|[^'\r\n])*')|("(?:\\"|[^"\r\n])*"))|(\s*=[^,\)]*))/mg,ee=/([^\s,]+)/g;function te(e){if(typeof e!="function")return[];let t=e.toString().replace(V,"");return t.slice(t.indexOf("(")+1,t.indexOf(")")).match(ee)??[]}var re=(e,t)=>{if(!(!e||typeof e!="object"||t.length===0)){var s=e,i=void 0;for(let n of t){if(!s.hasOwnProperty(n)){i=void 0;break}i=s=s[n]}return i}},se=(e,t,r="$")=>Array.from(t).map(s=>s.split(r).filter(Boolean)).filter(Boolean).map(s=>re(e,s)),ie=(e,t)=>e.length!==t.length?!1:e.every((r,s)=>{let i=t[s];return typeof r=="object"?r==i:r===i}),A=class{constructor(t){this.func=t,this.argNames=te(t)}call(t){return this.argNames.length===0?this.func.call(t):arguments.length===0?this.curOutput:this.apply(t,se(t,this.argNames))}apply(t,r){return arguments.length===0||this.curArgs&&ie(r,this.curArgs)?this.curOutput:(this.curArgs=r,this.curOutput=this.func.apply(t,r),this.curOutput)}},L=class{constructor(e,t){this.strings=e,this.functions=t.map(r=>typeof r=="function"?new A(r):()=>r)}build(e){let t=arguments.length;return this.strings.map((r,s)=>{let i=this.functions[s],n=i?t===0?i.call():i.call(e):"";return n&&n instanceof L&&(n=e?n.build(e):n.build()),[r,n]}).flat().filter(Boolean).join("")}},_e=(e,...t)=>new L(e,t),M=(e,t,r)=>new q(e,t,r),O,B,j,k,C,q=(C=class{constructor(e,t,{thisObj:r={},queryFnName:s="querySelectorAll",listenFnName:i="addEventListener",unlistenFnName:n="removeEventListener",notifyFnName:o="dispatchEvent",validator:u=l=>l.parentNode}={}){v(this,O);v(this,j);let l=this;l.rootEl=e,l.nodes={},l.wires=new WeakMap,l.funcs={queryFnName:s,listenFnName:i,unlistenFnName:n,notifyFnName:o,validator:u},l.this=new Proxy(r,{get(h,a){return a==="top_"&&!("top_"in r)?l:a==="fire_"&&!("fire_"in r)?l.fire.bind(l):l.nodes&&l.nodes[a]||Reflect.get(...arguments)},deleteProperty(h,a){if(!l.nodes||!l.nodes[a])return Reflect.deleteProperty(...arguments);let c=l.nodes[a];l.dewire(c),delete l.nodes[a]}}),Object.entries(t).forEach(([h,a])=>{var c,f,d;if(typeof a=="function"){let b=a;E(c=l,O,B).call(c,h).forEach((m,w,g)=>{var R;let p=b.call(l.this,m,w,g),{cfg:T,nodeId:J}=E(R=l,j,k).call(R,p);l.wire(m,T,J)})}else{let{cfg:b,nodeId:m}=E(f=l,j,k).call(f,a);E(d=l,O,B).call(d,h).forEach((w,g,p)=>{l.wire(w,b,m)})}})}wire(e,t,r){let s=this;if(!s.wires.has(e)){s.wires.set(e,[]);let n=r||`node-${++q._id}`;s.nodes[n]=e}let i=s.funcs.listenFnName;Object.entries(t).forEach(([n,o])=>{let u=o.bind(s.this);e[i](n,u),s.wires.get(e).push([n,u])})}dewire(e){let t=this,r=t.wires;if(!r.has(e))return!1;let s=t.funcs.unlistenFnName;r.get(e).forEach(([i,n])=>{e[s](i,n)})}delete(){let e=this;Object.values(e.nodes).forEach(t=>e.dewire(t)),e.rootEl=null,e.nodes=null,e.wires=null}clean(){let e=this,t=e.funcs.validator;for(let[r,s]of Object.entries(e.nodes))s==e.rootEl||t(s)||(e.dewire(s),delete e.nodes[r])}nodesThatListenTo(e,{isSkipRootEl:t=!1}={}){let r=this,s=r.wires;return Object.values(r.nodes).filter(i=>{if(!(!s.has(i)||t&&i===r.rootEl))return s.get(i).find(([n,o])=>n===e)})}fire(e,{isSkipRootEl:t=!1}={}){if(!e||!e.type)throw new Error("invalid event");let r=this,s=r.funcs.notifyFnName,i=e.type;r.nodesThatListenTo(i,{isSkipRootEl:t}).forEach(n=>{n[s]&&n[s].call(n,e)})}},O=new WeakSet,B=function(e){let t=this,r=t.funcs.queryFnName;return e==="."?[t.rootEl]:[...t.rootEl[r](e)]},j=new WeakSet,k=function(e){let t=this,r={},s=Object.fromEntries(Object.entries(e).filter(([o,u])=>{if(o[0]==="_"){let h=o.slice(1);return r[h]=u,!1}return!0})),i=r.id;if(t.this[i]||typeof t.this[i]=="function")throw new Error(`conflicting nodes "${i}"`);return{cfg:s,nodeId:i}},$(C,"_id",0),C),D={header:"",footer:""},Ee=(e,{_header:t=D.header,_footer:r=D.footer,_wires:s={},_attributes:i={},_formAssociated:n=!0,...o}={},{HTMLElement:u=globalThis.HTMLElement,document:l=globalThis.document,CustomEvent:h=globalThis.CustomEvent}={})=>class extends u{static formAssociated=n;constructor(){super(),this.template_=e,this.context_=Object.assign({root_:this,build_:this.build.bind(this),fire_:this.fire.bind(this)},o),this.wiresConfig=typeof s=="function"?s:()=>s,this.attachShadow({mode:"open"}),this.build()}build(a={}){this.wires_&&this.wires_.delete(),Object.assign(this.context_,a);let c=this.shadowRoot;for(;c.firstChild;)c.removeChild(c.firstChild);let f=l.createElement("template");f.innerHTML=[t,e.build(this.context_),r].filter(Boolean).join(""),c.appendChild(f.content.cloneNode(!0)),f=null,this.wires_=M(c,this.wiresConfig.call(this.context_,this),{thisObj:this.context_}),this.this=this.wires_.this}fire(a){this.wires_.fire(a),this.dispatchEvent(a)}connectedCallback(){let a=this,c=new h("connected",{detail:null});a.fire(c)}disconnectedCallback(){let a=this,c=new h("disconnected",{detail:null});a.fire(c)}adoptedCallback(){let a=this,c=new h("adopted",{detail:null});a.fire(c)}static get observedAttributes(){return Object.keys(i)}attributeChangedCallback(a,c,f){let d=i[a];d&&typeof d=="function"&&d.call(this.context_,f,c);let b=this,m=new h("attribute_changed",{detail:{name:a,value:f,oldValue:c}});b.fire(m)}},Oe=(e,t,r,{document:s=globalThis.document}={})=>new ne(e,t,r,{document:s}),ne=class{constructor(e,t,{_wires:r={},...s}={},{document:i=globalThis.document}){this.root=e,this.template_=t,this.context_=Object.assign({root_:this,build_:this.build.bind(this),fire_:this.fire.bind(this)},s),this.wiresConfig=typeof r=="function"?r:()=>r,this.document=i,this.build()}build(e={}){this.wires_&&this.wires_.delete(),Object.assign(this.context_,e);let t=this.root;for(;t.firstChild;)t.removeChild(t.firstChild);let r=this.document.createElement("template");r.innerHTML=this.template_.build(this.context_),t.appendChild(r.content.cloneNode(!0)),r=null,this.wires_=M(t,this.wiresConfig.call(this.context_,this),{thisObj:this.context_}),this.this=this.wires_.this}fire(e){this.wires_.fire(e,{isSkipRootEl:!0}),this.root.dispatchEvent(e)}},N=class{constructor({broadcastChannelId:t}){var r=this;if(r._id=0,r.channels={},t){let s=new BroadcastChannel(t);s.onmessage=i=>{let{channel:n,args:o}=i.data;r.publish_.apply(r,[n].concat(o))},r.broadcastChannel=s}}reset(){this._id=0,this.channels={}}channelId(t){let[r,...s]=(t||"").split(".");return[r,s.join(".")||`_${++this._id}`]}subscribe(t,r,s=!1){let[i,n]=this.channelId(t);if(!i)return;let o=this.channels;o[i]||(o[i]={});let u=o[i];if(u[n]&&!s)throw new Error(`subscribe: ${t} already exists`);return u[n]=r,[i,n].join(".")}unsubscribe(){let t=this;Array.from(arguments).flat().forEach(r=>{let[s,i]=t.channelId(r);if(!s)return;let n=t.channels[s];n&&delete n[i]})}publish_(t,...r){let s=this.channels[t];s&&Object.values(s).forEach(i=>{i.apply(null,r)})}publish(t,...r){let s=t.slice(-1)==="!";return t=s?t.slice(0,-1):t,s&&this.broadcastChannel&&this.broadcastChannel.postMessage({channel:t,args:r}),this.publish_.apply(this,[t].concat(r))}async exec(t,...r){let s=this.channels[t];if(!s)return;let i=Object.values(s).map(o=>o.apply(null,r)),n=await Promise.all(i);return Object.keys(s).reduce((o,u,l)=>(o[u]=n[l],o),{})}},le=globalThis.WEB_PUBSUB_BROADCAST_CHANNEL_ID||"web-pubsub-broadcast-channel-id",y=new N({broadcastChannelId:le});y.publish.bind(y);y.subscribe.bind(y);y.unsubscribe.bind(y);y.exec.bind(y);var H=e=>e==null||e===""||Array.isArray(e)&&e.length===0,oe=e=>typeof e=="string",ae=e=>typeof e=="boolean",U=e=>typeof e=="function",S=e=>e!==null&&e instanceof Object&&e.constructor===Object,je={isEmpty:H,isString:oe,isBoolean:ae,isFunction:U,isObject:S},W=e=>e==null?[]:Array.isArray(e)?e:[e],xe={from:W},ce=e=>{let t={};for(let r in e){let s=e[r];H(s)||(t[r]=s)}return t},ue=(e,t,r)=>{let s=t.split("."),i=s.pop();var n=e||{};return s.forEach(o=>{n.hasOwnProperty(o)||(n[o]={}),n=n[o]}),n[i]=r,e},he=(e,t,r)=>{let s=t.split("."),i=e||{};for(let n of s){if(!i.hasOwnProperty(n))return r;i=i[n]}return i},fe=(e,t)=>{let r=t.split("."),s=r.pop();var i=e||{};for(let n of r){if(!i.hasOwnProperty(n))return!1;i=i[n]}return delete i[s]},de=(e,t)=>{try{return JSON.parse(e)}catch{return t}},pe=(e,...t)=>(Array.from(t).filter(Boolean).forEach(r=>{for(let[s,i]of Object.entries(r)){let n=e[s];S(n)&&S(i)?e[s]={...n,...i}:Array.isArray(n)?e[s]=[...n,...W(i)]:e[s]=i}}),e),x={clean:ce,set:ue,get:he,trim:fe,parse:de,merge:pe},be=e=>U(e)?e:()=>e,Te={from:be},F=class{constructor(t,{initial:r={},store:s=globalThis.sessionStorage}={}){if(!t)throw new Error("store id required");this.id=t,this.value=r,this.store=s}set(t,r){return this.value=x.set(this.value||{},t,r),this.save(),this}get(t,r){return this.value&&t?x.get(this.value,t,r):this.value}trim(t){return t?x.trim(this.value,t):this.value={},this}save(){return this.store.setItem(this.id,JSON.stringify(this.value)),this}load(){let t=this.store.getItem(this.id);return this.value=x.parse(t)||{},this}reset(){return this.value={},this.store.removeItem(this.id),this}},me=e=>{if(e instanceof Worker)return P(e);let t;if(typeof e=="function"?t=`(${I})(${e})`:e instanceof Object&&e.constructor===Object?t=`(${I})(${ye(e)})`:typeof e=="string"&&(t=e),!t)throw new Error("unsupported type");let r=new Blob([t],{type:"text/javascript"}),s=URL.createObjectURL(r),i=new Worker(s,"Deno"in globalThis?{type:"module"}:{});return P(i)},ye=e=>`{ ${Object.entries(e).map(([t,r])=>`${t}:${typeof r=="function"?r+"":JSON.stringify(r)}`).join(",")} }`,P=e=>{let t=0,r={},s=(...i)=>new Promise((n,o)=>{let u=++t;e.postMessage({id:u,args:i}),r[u]={ok:n,err:o}});return e.onmessage=i=>{if(!i)return;let{id:n,data:o,error:u}=i.data||{};if(!n)return;let l=r[n];if(!l)return;delete r[n];let{ok:h,err:a}=l;return u?a(u):h(o)},new Proxy(s,{get(i,n){return n==="__worker"?e:(...o)=>new Promise((u,l)=>{let h=++t;e.postMessage({id:h,fn:n,args:o}),r[h]={ok:u,err:l}})}})},I=(e,t=null)=>{let r={};if(typeof e=="function")r._=e;else if(e!==null&&e instanceof Object&&e.constructor===Object)r=e;else throw new Error("please pass function/object");globalThis.onmessage=function(s){if(!s)return;let{id:i,fn:n="_",args:o}=s.data||{};(async()=>{var u={id:i};try{if(!r.hasOwnProperty(n))throw new Error("undefined property");let l=r[n],h=typeof l=="function";u.data=h?await l.apply(t||r,o):l,!h&&o.length>0&&(r[n]=o[0])}catch(l){u.error=l}globalThis.postMessage(u)})()}},ve={wrap:me,wrap_worker:P,proxy:I};export{xe as Arr,Te as Fn,je as Is,x as Obj,N as PubSub,F as Store,ve as Waaf,Y as ajax,_ as ajaxDefaults,ge as ajaxFn,Ee as customElement,D as customElementDefaults,_e as tmpl,M as wire,Oe as wireElement};
